<% @page_title = "Admin: Race: #{@race.name}" %>

<%= error_messages_for "race" %>

<h2><%= link_to_events(@race) %><%= @race.name %></h2>

<div class="container-fluid">
  <%= form_for [ :admin, @race ], :html => { :class => "form-horizontal" } do |f| -%>
  <div class="row-fluid">
      <div class="span6">
        <%= f.hidden_field :event_id %>
        <%= f.labelled_text_field :category_name, nil, :class => @race.new_record? ? "wants_focus span12" : "span12" %>

        <% if RacingAssociation.current.competitions.include?(:bar) -%>
        <%= f.labelled_text :bar_category, competition_category_name(@race), "BAR Category" %><br/><br/>
        <%= f.labelled_select :bar_points, bar_points_and_labels, :label => { :text => "BAR Points", :class => "control-label" }, :editable => administrator?, :class => "span12" %>
        <%- end %>

        <% if RacingAssociation.current.competitions.include?(:rider_rankings) -%>
        <%= f.labelled_text :bar_category, competition_category_name(@race), "Rankings Cat" %><br/><br/>
        <%= f.labelled_select :bar_points, bar_points_and_labels, :label => { :text => "Raking Pts", :class => "control-label" }, :editable => administrator?, :class => "span12" %>
        <%- end %>

        <% if RacingAssociation.current.sanctioning_organizations.many? -%>
        <%= f.labelled_select :sanctioned_by, RacingAssociation.current.sanctioning_organizations %>
        <%- end %>
      </div>

      <div class="span6">
        <%= f.labelled_text_field :notes, nil, :editable => administrator?, :class => "span12" %>
        <%= f.labelled_text_field :field_size, "Field Size (#{@race.results.size})", :editable => administrator?, :class => "span12" %>
        <%= f.labelled_text_field :distance, nil, :editable => administrator?, :class => "span12" %>
        <%= f.labelled_text_field :laps, nil, :editable => administrator?, :class => "span12" %>
      </div>
    </div>

    <div class="row-fluid">
      <div class="span12">
        <%= submit_tag "Save", :class => "btn btn-primary", :id => "save" %>
        <div class="created_updated pull-right"><%= "Updated: #{time_ago_in_words(@race.updated_at, true)} ago" if @race.updated_at.present? %>&nbsp;</div>
      </div>
    </div>
  <% end -%>    
</div>

<% if administrator? %>
<div class="container-fluid">
  <%= render :partial => "results", :locals => { :race => @race } %>
</div>
<% end %>
