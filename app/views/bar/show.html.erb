<% if @race
     @page_title = "BAR: #{@race.year}: #{@race.discipline}: #{@race.category.name}"
   else
     @page_title = "BAR"
   end  -%>

<%= render :partial => "years", :locals => { :overall_bar => @overall_bar, :race => @race } %>
<%= render :partial => "disciplines", :locals => { :overall_bar => @overall_bar, :race => @race } %>
<%= render(:partial => "races", :locals => { :race => @race, :categories => @race.event.races_with_results.map(&:category) }) if @race %>

<% if @race -%>
<h2><%= @race.year %> <%= @race.discipline %> <%= @race.name %> BAR</h2>

<p class="created_updated">Updated <%= @race.updated_at.to_formatted_s(:long) %></p>

<%= table :caption => @race.name, :class => "event_results", :collection => @race.results, :columns => 4 do %>
  <% 
    if @race.discipline == "Team"
      result_columns = %w{ place team_name points }
    else
      result_columns = %w{ place name team_name points }
    end
  %>
  <tr>
    <%- result_columns.map.each do |column| -%>
    <th class="<%= column %>"><%= result_header column %></th>
    <%- end -%>
  </tr>
  <%- @race.results.sort.each do |result| -%>
  <tr>
    <%- result_columns.each do |column| -%>
    <td<%= result_cell_class column %>><%= result_cell result, column %></td>
    <%- end -%>
  </tr>
  <%- end -%>
<%- end -%>

<% else %>
No results for <%= params[:year] %>
<% end -%>
