<% @page_title = "Mailing Lists: #{@mailing_list.friendly_name}" %>

<%= form_tag({}, { :method => "get", :id => "search_form", :class => "form-horizontal form-search" }) do %>
  <div class="row-fluid">
    <div class="span3"></div>
    <div class="span6 input-append">
      <%= search_field_tag("subject", @subject, :class => "wants_focus search-query span12", :placeholder => "Search by subject") %>
      <button type="submit" class="btn"><i class="icon-search"></i></button>
    </div>
  </div>
<% end -%>

<%= will_paginate @posts, :renderer => BootstrapPagination::Rails %>

<div class="post_search_header">
  <div class="post_dates">
  <% if @start_date && @end_date %>
    <%= @start_date.to_s(:long_and_friendly) %> to <%= @end_date.to_s(:long_and_friendly)%>. 
    <%= link_to "Clear", mailing_list_posts_path(@mailing_list), :class => "obvious" %>
  <% end %>
  </div>
</div>

<%= table :collection => @posts, :columns => 3 do %>
  <tr>
    <th class="date">Date</th>
    <th class="subject">Subject</th>
    <th class="from">From</th>
  </tr>
  <% @posts.each do |post| %>
  <tr>
    <td class="date"><%= link_to post.date.strftime("%m/%d/%Y"), post_path(post, :page => @posts.current_page) %></td>
    <td class="subject">
      <%= link_to h(truncate(post.subject, :length => 50)), post_path(post, :page => @posts.current_page) %>
    </td>
    <td class="from"><%= h(post.sender_obscured) %></td>
  </tr>
  <% end %>
<% end -%>

<%= will_paginate @posts, :renderer => BootstrapPagination::Rails %>

<% if @first_post_at %>
<ul class="nav">
  <% Time.zone.now.year.downto(@first_post_at.year).each do |year| %>
  <li><%= link_to year, mailing_list_posts_path(@mailing_list, :year => year, :month => params[:month]) %></li>
  <% end %>
</ul>
<ul class="nav">
  <% (1..12).each do |month| %>
  <li><%= link_to Date::MONTHNAMES[month], mailing_list_posts_path(@mailing_list, :year => params[:year], :month => month) %></li>
  <% end %>
</ul>
<% end %>

<%= render("mailing_lists/links", :mailing_list => @mailing_list) %>

<% content_for :head do -%>
<%= auto_discovery_link_tag :atom, :format => :atom %>
<% end %>
